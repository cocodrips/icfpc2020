{% extends "base.html" %}
{% block title %}visualizer{% endblock %}


{% block body %}



    <form action="/visualizer" type="get">
        <div uk-grid>
        <div class="uk-width-3-4">
            <textarea name="raw_data" placeholder="[flag, state, data]"
                      class="uk-textarea uk-width-4-5" cols="100" rows="3"
                      style="width: 100%">{% if raw_data %}{{ raw_data }}{% endif %}</textarea>
        </div>
        <div class="uk-width-1-4">
            <button class="uk-button uk-button-default" type="submit">visualize</button>
        </div>
        </div>
    </form>

    <div class="uk-grid uk-margin">
    <div class="uk-width-1-2">
        <p class="uk-margin-small">
            all
        </p>
        <canvas id="canvas-all"
                width="{{ pictures.width * pictures.scale }}"
                height="{{ pictures.height * pictures.scale }}"></canvas>
        <script>
            console.log("{{ pictures.ymin }}~{{ pictures.ymax }}, {{ pictures.xmin }}~{{ pictures.xmax }}")
            let canvas_all = document.getElementById("canvas-{{ picture.index }}");
            let context_all = canvas.getContext("2d");
            context_all.scale({{ pictures.scale }}, {{ pictures.scale }});

            context_all.fillStyle = "black";
            context_all.fillRect(0, 0, canvas.width, canvas.height);

            context_all.fillStyle = "#666";
            context_all.fillRect({{ -pictures.xmin }}, {{ -pictures.ymin }}, 1, 1);
            
            context_all.fillStyle = "#20cfcd";
            context_all.globalAlpha = 0.2;


        </script>

    </div>
    <div class="uk-grid uk-margin">


        {% for picture in pictures.pictures %}

            <div class="uk-width-1-3">
                <p class="uk-margin-small">
                    {{ picture.index }}
                </p>
                <canvas id="canvas-{{ picture.index }}"
                        width="{{ pictures.width * pictures.scale }}"
                        height="{{ pictures.height * pictures.scale }}"></canvas>
            </div>



            <script>
                console.log("{{ pictures.ymin }}~{{ pictures.ymax }}, {{ pictures.xmin }}~{{ pictures.xmax }}")
                var canvas = document.getElementById("canvas-{{ picture.index }}");
                var context = canvas.getContext("2d");
                context.scale({{ pictures.scale }}, {{ pictures.scale }});

                context.fillStyle = "black";
                context.fillRect(0, 0, canvas.width, canvas.height);

                context.fillStyle = "#20cfcd";

                {% for point in picture.points %}
                    context.fillRect({{ point[0] - pictures.xmin }}, {{ point[1] - pictures.ymin }}, 1, 1);
                {% endfor %}

                {% for point in picture.points %}
                    context_all.fillRect({{ point[0] - pictures.xmin }}, {{ point[1] - pictures.ymin }}, 1, 1);
                {% endfor %}


                context.fillStyle = "#666";
                context.fillRect({{ -pictures.xmin }}, {{ -pictures.ymin }}, 1, 1);

            </script>
        {% endfor %}
    </div>

{% endblock %}



